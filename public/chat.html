<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>사장님AI — 채팅</title>
  <link rel="stylesheet" href="/css/style.css">
  <!-- PDF export library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- auth guard: auth.js requireLogin()이 담당 (Supabase getSession 비동기 대기) -->
</head>
<body class="chat-body">
  <main class="chat-page">
    <!-- 헤더 -->
    <header class="chat-header" id="header-bar">
      <button class="back" id="back-btn" aria-label="뒤로 가기">←</button>
      <span id="persona-name">로딩 중...</span>
      <div class="header-actions">
        <!-- 내보내기 버튼 -->
        <div class="export-wrapper" id="export-wrapper">
          <button class="export-btn" id="export-btn" aria-label="대화 내보내기" title="대화 내보내기">
            📥 내보내기
          </button>
          <div class="export-menu" id="export-menu" style="display: none;">
            <button class="export-option" data-format="txt" aria-label="TXT로 저장">
              📄 TXT로 저장
            </button>
            <button class="export-option" data-format="pdf" aria-label="PDF로 저장">
              📑 PDF로 저장
            </button>
          </div>
        </div>
        <label class="format-toggle" title="답변 형식 전환">
          <input type="checkbox" id="format-toggle" checked>
          <span class="toggle-track">
            <span class="toggle-thumb"></span>
          </span>
          <span class="toggle-label" id="toggle-label">📝 구조화</span>
        </label>
      </div>
    </header>

    <!-- 채팅 영역 -->
    <div id="chat-messages" class="chat-messages" role="log" aria-live="polite" aria-label="채팅 메시지"></div>

    <!-- 입력 영역 -->
    <footer class="chat-input-area">
      <textarea
        id="chat-input"
        placeholder="사장님 상황을 편하게 말씀해주세요..."
        rows="1"
        maxlength="2000"
        aria-label="메시지 입력"
      ></textarea>
      <button id="send-btn" aria-label="메시지 전송">전송</button>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/chat.js"></script>
  <script src="/js/export.js"></script>
</body>
</html>
